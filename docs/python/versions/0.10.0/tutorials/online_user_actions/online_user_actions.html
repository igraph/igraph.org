




<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Favicon and theming -->
    <meta name="theme-color" content="#ffffff" />
    <link rel="icon" href="/favicon.svg" />
    <link rel="alternate icon" href="/favicon.ico" />

    <title>Online user actions</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom styles for this template -->
    <link href="//fonts.googleapis.com/css?family=Lato:300,400,700"
          rel="stylesheet" type="text/css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/fonts/font-mfizz/font-mfizz.css">
    <link href="/css/affix.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/other.css" rel="stylesheet">
    <link href="/fonts/fonts.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements 
         and media queries -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
      <script src="/js/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DY4MJME11Z"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-DY4MJME11Z');
	</script>

    <link rel="top" title="igraph 0.10.0 documentation" href="../../index.html" /> <link rel="up" title="Gallery" href="../../gallery.html" /> <link rel="next" title="Quick Start" href="../quickstart/quickstart.html" /> <link rel="prev" title="Minimum Spanning Trees" href="../minimum_spanning_trees/minimum_spanning_trees.html" /> <link rel="stylesheet" href="../../_static/basic.css" type="text/css" /> <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" /> <link rel="stylesheet" href="../../_static/other.css" type="text/css" />
  </head>

  <body class="python">
  <div id="wrap">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="/">
        <img src="/img/igraph_logo_white.svg" width="35"> igraph
      </a>

      
      <ul class="navbar-nav mr-auto">
        
        <li class="nav-item"><a class="nav-link" href="/python/versions/latest">python-igraph</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
            0.10.0
          </a>
          <div class="dropdown-menu" id="doc-version-switcher">
            <a class="dropdown-item" href="#">Please wait...</a>
          </div>
        </li>
        
      </ul>
      

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" id="productsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Products</a>
            <div class="dropdown-menu" aria-labelledby="productsDropdown">
              <a class="dropdown-item" href="/r">igraph R package</a>
              <a class="dropdown-item" href="/python">python-igraph</a>
              <a class="dropdown-item" href="http://szhorvat.net/mathematica/IGraphM">IGraph/M</a>
              <a class="dropdown-item" href="/c">igraph C library</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="https://github.com/igraph/igraphdata">igraphdata R package <i class="fa fa-github"></i></a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/news.html"><i class="fa fa-rss"></i> News</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://igraph.discourse.group"><i class="fa fa-comments"></i> Forum</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/code-of-conduct.html"><i class="fa fa-gavel"></i> Code of Conduct</a>
          </li>          
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/igraph"><i class="fa fa-github"></i> On GitHub</a>
          </li>
        </ul>
      </div>
    </nav>
    
    

    <div class="jumbotron">
      <div class="container">
        <h1 class="display-4">python-igraph Manual</h1>
        <p class="lead">For using igraph from Python</p>
      </div>
      <canvas id="jumbotron-anim"></canvas>
    </div>

    

      <div class="main container">


<div class="row">
  <div class="col-md-12">
    <div class="navigation-header mb-4" width="100%" summary="Navigation header">
      <div class="btn-group" role="group">
        <a href="../minimum_spanning_trees/minimum_spanning_trees.html" title="Previous Chapter: Minimum Spanning Trees" class="btn btn-light" role="button" accesskey="P">
          <i class="fa fa-chevron-left"></i> Minimum Spanning Trees
        </a>
        <a href="../../gallery.html" title="Parent: Gallery" class="btn btn-light" role="button" accesskey="U">
          <i class="fa fa-chevron-up"></i> Gallery
        </a>
        <a href="../quickstart/quickstart.html" title="Next Chapter: Quick Start" class="btn btn-light" role="button" accesskey="N">
          Quick Start <i class="fa fa-chevron-right"></i>
        </a>
      </div>
    </div>
  </div>
</div>


    <div class="row">
      <div class="document col-md-12">
      <div class="documentwrapper bs-docs-section" id="top-of-docs">
        <h1 class="real">
          Online user actions
          <a class="headerlink" href="#top-of-docs" title="Permalink to this headline">¶</a>
        </h1>
        <!-- <ul>
<li><a class="reference internal" href="#">Online user actions</a></li>
</ul>
 -->
        
  <section id="online-user-actions">
<span id="tutorials-online-user-actions"></span><h1>Online user actions<a class="headerlink" href="#online-user-actions" title="Permalink to this heading">¶</a></h1>
<p>This example reproduces a typical data science situation in an internet company. We start from a pandas DataFrame with online user actions, for instance for an online text editor: the user can create a page, edit it, or delete it. We want to construct and visualize a graph of the users highlighting collaborations on the same page/project.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># User data (usually would come with time stamp)</span>
<span class="n">action_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;dsj3239asadsa3&#39;</span><span class="p">,</span> <span class="s1">&#39;createPage&#39;</span><span class="p">,</span> <span class="s1">&#39;greatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;2r09ej221sk2k5&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;greatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;dsj3239asadsa3&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;greatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;789dsadafj32jj&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;greatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;oi32ncwosap399&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;greatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;4r4320dkqpdokk&#39;</span><span class="p">,</span> <span class="s1">&#39;createPage&#39;</span><span class="p">,</span> <span class="s1">&#39;miniProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;320eljl3lk3239&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;miniProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;dsj3239asadsa3&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;miniProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;3203ejew332323&#39;</span><span class="p">,</span> <span class="s1">&#39;createPage&#39;</span><span class="p">,</span> <span class="s1">&#39;private&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;3203ejew332323&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;private&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;40m11919332msa&#39;</span><span class="p">,</span> <span class="s1">&#39;createPage&#39;</span><span class="p">,</span> <span class="s1">&#39;private2&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;40m11919332msa&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;private2&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;dsj3239asadsa3&#39;</span><span class="p">,</span> <span class="s1">&#39;createPage&#39;</span><span class="p">,</span> <span class="s1">&#39;anotherGreatProject&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;2r09ej221sk2k5&#39;</span><span class="p">,</span> <span class="s1">&#39;editPage&#39;</span><span class="p">,</span> <span class="s1">&#39;anotherGreatProject&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;project&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This block just introduces the toy data: a DataFrame with three columns, namely the user id, the action, and the page or project that was being actioned upon. Now we need to check when two users worked on the same page. We choose to use a weighted adjacency matrix for this, i.e. a table with rows and columns indexes by the users that has nonzero entries whenever folks collaborate. First, let’s get the users and prepare an empty matrix:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">action_dataframe</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">users</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">users</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, let’s iterate over all projects one by one, and add all collaborations:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">project</span><span class="p">,</span> <span class="n">project_data</span> <span class="ow">in</span> <span class="n">action_dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;project&#39;</span><span class="p">):</span>
    <span class="n">project_users</span> <span class="o">=</span> <span class="n">project_data</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">user1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">project_users</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="n">project_users</span><span class="p">[:</span><span class="n">i1</span><span class="p">]:</span>
            <span class="n">adjacency_matrix</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">user1</span><span class="p">,</span> <span class="n">user2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>There are many ways to achieve the above matrix, so don’t be surprised if you came up with another algorithm ;-)</p>
<p>Now it’s time to make the graph:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Weighted_Adjacency</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;plus&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And finally, let’s plot a layout of the graph, for instance a circle:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a layout first</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span>

<span class="c1"># Make vertex size based on their closeness to other vertices</span>
<span class="n">vertex_size</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">closeness</span><span class="p">()</span>
<span class="n">vertex_size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.05</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertex_size</span><span class="p">]</span>

<span class="c1"># Make mpl axes</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Plot graph in that axes</span>
<span class="n">ig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">g</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="n">vertex_label</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="n">vertex_color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
    <span class="n">vertex_size</span><span class="o">=</span><span class="n">vertex_size</span><span class="p">,</span>
    <span class="n">edge_width</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>We added a few fancy features to this plot to show off igraph’s capabilities. The result is shown below.</p>
<figure class="align-center" id="id1">
<img alt="A visual representation of the collaboratoin graph" src="../../_images/online_user_actions.png" />
<figcaption>
<p><span class="caption-text">The collaboration graph: thicker edges mean multiple collaborations, and larger vertices indicate users with higher closeness to the rest of the network.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Loops indicate “self-collaborations”, which are not very meaningful. To filter out loops without losing the edge weights, we can use:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">combine_edges</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then repeat the plotting code verbatim. The result is shown below.</p>
<figure class="align-center" id="id2">
<img alt="A visual representation of the collaboratoin graph" src="../../_images/online_users_simple.png" />
<figcaption>
<p><span class="caption-text">Simplified graph after loops are filtered out.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>


      </div>
    </div>
    <div class="clearer"></div>
    </div>
  </div>


    </div>

    <div id="footer"><div class="container-fluid">
      <p class="text-muted credit">
	  &copy; 2003 &ndash; 2023 The igraph core team.
            &bull; Code licensed under 
            <a href="http://www.gnu.org/licenses/gpl-2.0.html">
            GNU GPL 2</a> or later, documentation under 
            <a href="http://www.gnu.org/copyleft/fdl.html">
              GNU FDL.</a>
      </p>
    </div></div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script src="/js/affix.js"></script>
    <script src="/js/jumbotron.js"></script>
    <script src="/js/toggle.js"></script>


    <script src="/js/doc-version-switcher.js"></script>
    <script>
        generateVersionSwitcher('#doc-version-switcher', 'python', 'tutorial/');
    </script>





    
  </body>
</html>
